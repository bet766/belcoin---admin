<!-- arquivo: painel.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel Belcoin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 10px; background: #f1f1f1; }
    .painel { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px gray; margin-bottom: 30px; }
    .titulo { font-size: 20px; font-weight: bold; margin-bottom: 10px; }
    .input { margin: 5px 0; padding: 6px; width: 100%; }
    .botao { padding: 10px; background: #00c853; color: white; border: none; cursor: pointer; border-radius: 6px; }
    .tabela { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .tabela th, .tabela td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    .secao { margin-bottom: 40px; }
  </style>
</head>
<body>
  <div class="painel">
    <div class="titulo">üîê Painel Administrativo - Belcoin</div>

    <div class="secao">
      <div class="titulo">üìä Estat√≠sticas</div>
      <div>Total de Usu√°rios: <span id="totalUsuarios">...</span></div>
      <div>Total Investido: R$ <span id="totalInvestido">0.00</span></div>
      <div>Total Sacado: R$ <span id="totalSacado">0.00</span></div>
    </div>

    <div class="secao">
      <div class="titulo">üë§ Gerenciar Usu√°rios</div>
      <table class="tabela" id="tabelaUsuarios">
        <thead>
          <tr><th>Nome</th><th>Email</th><th>CPF</th><th>Telefone</th><th>Saldo</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="secao">
      <div class="titulo">üí∞ Ajustar Saldo</div>
      <input class="input" type="text" id="emailSaldo" placeholder="Email do usu√°rio">
      <input class="input" type="number" id="valorSaldo" placeholder="Valor a adicionar (+) ou remover (-)">
      <button class="botao" onclick="ajustarSaldo()">Atualizar Saldo</button>
    </div>

    <div class="secao">
      <div class="titulo">üßë‚Äçüíº Cargos</div>
      <input class="input" type="text" id="emailCargo" placeholder="Email do usu√°rio">
      <select class="input" id="cargoSelecionado">
        <option value="admin">Admin</option>
        <option value="suporte">Suporte</option>
        <option value="nenhum">Remover Cargo</option>
      </select>
      <button class="botao" onclick="atualizarCargo()">Atualizar Cargo</button>
    </div>

    <div class="secao">
      <div class="titulo">üéÅ Cupons</div>
      <input class="input" type="text" id="codigoCupom" placeholder="C√≥digo do cupom">
      <input class="input" type="number" id="valorCupom" placeholder="Valor em R$">
      <button class="botao" onclick="criarCupom()">Criar Cupom</button>
      <div id="listaCupons"></div>
    </div>

    <div class="secao">
      <div class="titulo">üí∏ Saques Pendentes</div>
      <table class="tabela" id="tabelaSaques">
        <thead><tr><th>Email</th><th>Valor</th><th>Status</th><th>A√ß√£o</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="secao">
      <div class="titulo">üìÜ Movimenta√ß√µes do Dia</div>
      <div id="movimentacoesHoje"></div>
    </div>

    <div class="secao">
      <div class="titulo">üìú Logs em Tempo Real</div>
      <div id="logsTempoReal" style="max-height:200px; overflow-y: scroll;"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDg-uRqxD6-B4zQnn6buPUZEDTh7aHoBK8",
      authDomain: "belcoin-92ee8.firebaseapp.com",
      projectId: "belcoin-92ee8",
      storageBucket: "belcoin-92ee8.appspot.com",
      messagingSenderId: "604040948702",
      appId: "1:604040948702:web:eb"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function carregarEstatisticas() {
      const usuarios = await db.collection("usuarios").get();
      document.getElementById("totalUsuarios").innerText = usuarios.size;

      let totalInvestido = 0;
      let totalSacado = 0;
      const movs = await db.collection("movimentacoes").get();
      movs.forEach(doc => {
        const m = doc.data();
        if (m.tipo === "investimento") totalInvestido += Number(m.valor);
        if (m.tipo === "saque") totalSacado += Number(m.valor);
      });
      document.getElementById("totalInvestido").innerText = totalInvestido.toFixed(2);
      document.getElementById("totalSacado").innerText = totalSacado.toFixed(2);
    }

    db.collection("usuarios").onSnapshot(snapshot => {
      const tabela = document.querySelector("#tabelaUsuarios tbody");
      tabela.innerHTML = "";
      snapshot.forEach(doc => {
        const u = doc.data();
        tabela.innerHTML += `
          <tr>
            <td>${u.nome}</td>
            <td>${u.email}</td>
            <td>${u.cpf}</td>
            <td>${u.telefone}</td>
            <td>R$ ${Number(u.saldo || 0).toFixed(2)}</td>
            <td><button onclick="excluirUsuario('${doc.id}')">Excluir</button></td>
          </tr>`;
      });
    });

    function ajustarSaldo() {
      const email = document.getElementById("emailSaldo").value;
      const valor = Number(document.getElementById("valorSaldo").value);
      db.collection("usuarios").where("email", "==", email).get().then(snapshot => {
        snapshot.forEach(doc => {
          const atual = Number(doc.data().saldo || 0);
          doc.ref.update({ saldo: atual + valor });
          db.collection("logs").add({
            email,
            acao: Saldo ajustado: R$ ${valor},
            data: new Date().toISOString()
          });
        });
      });
    }

    function atualizarCargo() {
      const email = document.getElementById("emailCargo").value;
      const cargo = document.getElementById("cargoSelecionado").value;
      db.collection("usuarios").where("email", "==", email).get().then(snapshot => {
        snapshot.forEach(doc => {
          const novoCargo = cargo === "nenhum" ? firebase.firestore.FieldValue.delete() : cargo;
          doc.ref.update({ cargo: novoCargo });
          db.collection("logs").add({
            email,
            acao: Cargo atualizado: ${cargo},
            data: new Date().toISOString()
          });
        });
      });
    }

    function criarCupom() {
      const codigo = document.getElementById("codigoCupom").value;
      const valor = Number(document.getElementById("valorCupom").value);
      db.collection("cupons").doc(codigo).set({
        valor, criado: new Date().toISOString()
      });
      alert("Cupom criado com sucesso!");
    }

    db.collection("cupons").onSnapshot(snapshot => {
      const div = document.getElementById("listaCupons");
      div.innerHTML = "<ul>";
      snapshot.forEach(doc => {
        div.innerHTML += <li>${doc.id}: R$ ${doc.data().valor}</li>;
      });
      div.innerHTML += "</ul>";
    });

    db.collection("saques").where("status", "==", "pendente").onSnapshot(snapshot => {
      const tabela = document.querySelector("#tabelaSaques tbody");
      tabela.innerHTML = "";
      snapshot.forEach(doc => {
        const s = doc.data();
        tabela.innerHTML += `
          <tr>
            <td>${s.email}</td>
            <td>R$ ${s.valor}</td>
            <td>${s.status}</td>
            <td><button onclick="aprovarSaque('${doc.id}')">Aprovar</button></td>
          </tr>`;
      });
    });

    function aprovarSaque(id) {
      db.collection("saques").doc(id).update({ status: "aprovado" });
    }

    function excluirUsuario(uid) {
      if (confirm("Deseja excluir esse usu√°rio?")) {
        db.collection("usuarios").doc(uid).delete();
      }
    }

    db.collection("logs").orderBy("data", "desc").limit(20).onSnapshot(snapshot => {
      const logs = document.getElementById("logsTempoReal");
      logs.innerHTML = "";
      snapshot.forEach(doc => {
        const l = doc.data();
        logs.innerHTML += <div>[${l.data}] ${l.email}: ${l.acao}</div>;
      });
    });

    const hoje = new Date().toISOString().split("T")[0];
    db.collection("movimentacoes").onSnapshot(snapshot => {
      const div = document.getElementById("movimentacoesHoje");
      div.innerHTML = "";
      snapshot.forEach(doc => {
        const m = doc.data();
        if (m.data?.startsWith(hoje)) {
          div.innerHTML += <div>${m.email} - ${m.tipo}: R$ ${m.valor}</div>;
        }
      });
    });

    carregarEstatisticas();
  </script>
</body>
</html>
