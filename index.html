<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Painel Administrativo - Belcoin</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f1f1f1;
    margin: 0; padding: 20px;
  }
  .painel {
    max-width: 1100px;
    margin: 0 auto;
    background: #fff;
    padding: 20px 30px;
    border-radius: 10px;
    box-shadow: 0 0 12px rgba(0,0,0,0.15);
  }
  h1 {
    margin-bottom: 10px;
    color: #00c853;
  }
  .estatisticas {
    display: flex;
    gap: 20px;
    margin-bottom: 25px;
  }
  .estatistica-box {
    flex: 1;
    background: #e0f2f1;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    font-size: 1.2em;
    color: #00695c;
  }
  .secao {
    margin-bottom: 30px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  table th, table td {
    border: 1px solid #ddd;
    padding: 10px;
  }
  table th {
    background: #00c853;
    color: #fff;
  }
  button {
    background: #00c853;
    color: white;
    border: none;
    padding: 8px 15px;
    cursor: pointer;
    border-radius: 5px;
  }
  button:hover {
    background: #009624;
  }
  input, select {
    padding: 8px;
    width: 100%;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
</style>
</head>
<body>

<div class="painel" id="painel-principal" style="display:none;">
  <h1>游댏 Painel Administrativo - Belcoin</h1>

  <div class="estatisticas">
    <div class="estatistica-box">Total de Usu치rios<br/><span id="totalUsuarios">0</span></div>
    <div class="estatistica-box">Total Investido<br/>R$ <span id="totalInvestido">0.00</span></div>
    <div class="estatistica-box">Total Sacado<br/>R$ <span id="totalSacado">0.00</span></div>
  </div>

  <div class="secao">
    <h2>游논 Usu치rios Cadastrados</h2>
    <table id="tabelaUsuarios">
      <thead>
        <tr><th>Nome</th><th>Email</th><th>CPF</th><th>Telefone</th><th>Saldo</th><th>A칞칫es</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="secao">
    <h2>游눯 Ajustar Saldo Manualmente</h2>
    <input type="text" id="emailSaldo" placeholder="Email do usu치rio" />
    <input type="number" id="valorSaldo" placeholder="Valor a adicionar (+) ou remover (-)" />
    <button onclick="ajustarSaldo()">Atualizar Saldo</button>
  </div>
</div>

<script>
  // Senha master fixa
  const senhaMaster = "RBAP7.0";

  function pedirSenha() {
    let senha = prompt("Digite a senha master para acessar o Painel Belcoin:");
    if (senha === senhaMaster) {
      document.getElementById("painel-principal").style.display = "block";
      iniciarPainel();
    } else {
      alert("Senha incorreta! Acesso negado.");
      // Opcional: bloquear acesso fechando a p치gina ou pedindo novamente
      pedirSenha();
    }
  }

  pedirSenha();

  // Firebase config (seu projeto)
  const firebaseConfig = {
    apiKey: "AIzaSyDg-uRqxD6-B4zQnn6buPUZEDTh7aHoBK8",
    authDomain: "belcoin-92ee8.firebaseapp.com",
    projectId: "belcoin-92ee8",
    storageBucket: "belcoin-92ee8.appspot.com",
    messagingSenderId: "604040948702",
    appId: "1:604040948702:web:eb"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function iniciarPainel() {
    carregarEstatisticas();
    listarUsuarios();
  }

  async function carregarEstatisticas() {
    const usuariosSnap = await db.collection("usuarios").get();
    document.getElementById("totalUsuarios").innerText = usuariosSnap.size;

    let totalInvestido = 0;
    let totalSacado = 0;

    const movimentacoesSnap = await db.collection("movimentacoes").get();
    movimentacoesSnap.forEach(doc => {
      const mov = doc.data();
      if (mov.tipo === "investimento") totalInvestido += Number(mov.valor);
      if (mov.tipo === "saque") totalSacado += Number(mov.valor);
    });

    document.getElementById("totalInvestido").innerText = totalInvestido.toFixed(2);
    document.getElementById("totalSacado").innerText = totalSacado.toFixed(2);
  }

  function listarUsuarios() {
    db.collection("usuarios").onSnapshot(snapshot => {
      const tbody = document.querySelector("#tabelaUsuarios tbody");
      tbody.innerHTML = "";
      snapshot.forEach(doc => {
        const u = doc.data();
        tbody.innerHTML += `
          <tr>
            <td>${u.nome || "-"}</td>
            <td>${u.email || "-"}</td>
            <td>${u.cpf || "-"}</td>
            <td>${u.telefone || "-"}</td>
            <td>R$ ${Number(u.saldo || 0).toFixed(2)}</td>
            <td><button onclick="excluirUsuario('${doc.id}')">Excluir</button></td>
          </tr>
        `;
      });
    });
  }

  function ajustarSaldo() {
    const email = document.getElementById("emailSaldo").value.trim();
    const valor = Number(document.getElementById("valorSaldo").value);
    if (!email || isNaN(valor)) {
      alert("Preencha os campos corretamente!");
      return;
    }
    db.collection("usuarios").where("email", "==", email).get().then(snapshot => {
      if (snapshot.empty) {
        alert("Usu치rio n칚o encontrado.");
        return;
      }
      snapshot.forEach(doc => {
        const atual = Number(doc.data().saldo || 0);
        doc.ref.update({ saldo: atual + valor });
        alert("Saldo atualizado com sucesso!");
      });
    });
  }

  function excluirUsuario(uid) {
    if (confirm("Tem certeza que deseja excluir esse usu치rio?")) {
      db.collection("usuarios").doc(uid).delete();
    }
  }
</script>

</body>
</html>
