<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel Administrativo Belcoin</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f7fa;
      display: flex;
      height: 100vh;
    }
    nav {
      width: 250px;
      background: #111827;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      box-sizing: border-box;
    }
    nav h2 {
      margin-bottom: 2rem;
      font-weight: 700;
      font-size: 1.4rem;
      text-align: center;
    }
    nav a {
      color: white;
      text-decoration: none;
      margin-bottom: 1rem;
      padding: 0.6rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    nav a:hover, nav a.active {
      background-color: #2563eb;
    }
    main {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
    }
    header {
      background-color: #1f2937;
      color: white;
      padding: 1rem;
      text-align: center;
      font-weight: 700;
      font-size: 1.8rem;
      user-select: none;
    }
    .card {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
      margin-bottom: 1.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table thead tr {
      background-color: #2563eb;
      color: white;
    }
    table th, table td {
      padding: 0.8rem 1rem;
      border: 1px solid #ddd;
      text-align: left;
    }
    button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #1e40af;
    }
    input, select {
      padding: 0.5rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      box-sizing: border-box;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .logout-btn {
      margin-top: auto;
      background-color: #ef4444;
      margin-left: 0;
    }
    .logout-btn:hover {
      background-color: #b91c1c;
    }
    /* Login */
    #login-container {
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      max-width: 350px;
      width: 100%;
      box-sizing: border-box;
    }
    #login-container h2 {
      margin-bottom: 1.5rem;
      text-align: center;
    }
    #login-container input {
      margin-bottom: 1rem;
    }
    #error-message {
      color: #ef4444;
      text-align: center;
      margin-bottom: 1rem;
    }
    /* Scroll */
    main::-webkit-scrollbar {
      width: 8px;
    }
    main::-webkit-scrollbar-thumb {
      background: #2563eb;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<!-- Login -->
<div id="login-screen" style="width:100%; height:100vh; display:flex; align-items:center; justify-content:center;">
  <div id="login-container">
    <h2>Login Admin</h2>
    <div id="error-message"></div>
    <input type="email" id="email" placeholder="E-mail" required />
    <input type="password" id="password" placeholder="Senha" required />
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- Painel -->
<div id="panel" style="display:none; width: 100%; height: 100vh; flex-direction: row;">
  <nav>
    <h2>Belcoin</h2>
    <a href="#" onclick="showSection('dashboard')" id="link-dashboard" class="active">Dashboard</a>
    <a href="#" onclick="showSection('usuarios')" id="link-usuarios">Usuários</a>
    <a href="#" onclick="showSection('investimentos')" id="link-investimentos">Investimentos</a>
    <a href="#" onclick="showSection('saques')" id="link-saques">Saques</a>
    <a href="#" onclick="showSection('cupons')" id="link-cupons">Cupons</a>
    <a href="#" onclick="showSection('cargos')" id="link-cargos">Cargos</a>
    <a href="#" onclick="showSection('logs')" id="link-logs">Logs</a>
    <button class="logout-btn" onclick="logout()">Sair</button>
  </nav>
  <main>
    <header id="header-title">Dashboard</header>
    <section id="dashboard" class="content-section">
      <div class="card">
        <h3>Total de Usuários</h3>
        <p id="totalUsuarios">Carregando...</p>
      </div>
      <div class="card">
        <h3>Total de Investimentos</h3>
        <p id="totalInvestimentos">Carregando...</p>
      </div>
      <div class="card">
        <h3>Total de Saques</h3>
        <p id="totalSaques">Carregando...</p>
      </div>
    </section>

    <section id="usuarios" class="content-section" style="display:none;">
      <div class="card">
        <h3>Usuários Cadastrados</h3>
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>E-mail</th>
              <th>CPF</th>
              <th>Telefone</th>
              <th>Saldo (R$)</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="usuarios-lista"></tbody>
        </table>
      </div>
    </section>

    <section id="investimentos" class="content-section" style="display:none;">
      <div class="card">
        <h3>Investimentos</h3>
        <table>
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Valor (R$)</th>
              <th>Data</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="investimentos-lista"></tbody>
        </table>
      </div>
    </section>

    <section id="saques" class="content-section" style="display:none;">
      <div class="card">
        <h3>Saques</h3>
        <table>
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Valor (R$)</th>
              <th>Data</th>
              <th>Status</th>
              <th>Aprovar</th>
            </tr>
          </thead>
          <tbody id="saques-lista"></tbody>
        </table>
      </div>
    </section>

    <section id="cupons" class="content-section" style="display:none;">
      <div class="card">
        <h3>Cupons</h3>
        <form id="form-cupom" onsubmit="criarCupom(event)">
          <div class="form-group">
            <input type="text" id="codigo-cupom" placeholder="Código do cupom" required />
          </div>
          <div class="form-group">
            <input type="number" id="desconto-cupom" placeholder="Desconto (%)" min="1" max="100" required />
          </div>
          <button type="submit">Criar Cupom</button>
        </form>
        <table style="margin-top:1rem;">
          <thead>
            <tr>
              <th>Código</th>
              <th>Desconto (%)</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="cupons-lista"></tbody>
        </table>
      </div>
    </section>

    <section id="cargos" class="content-section" style="display:none;">
      <div class="card">
        <h3>Gerenciar Cargos</h3>
        <table>
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Cargo Atual</th>
              <th>Alterar Cargo</th>
            </tr>
          </thead>
          <tbody id="cargos-lista"></tbody>
        </table>
      </div>
    </section>

    <section id="logs" class="content-section" style="display:none;">
      <div class="card">
        <h3>Logs em Tempo Real</h3>
        <ul id="logs-lista" style="max-height: 400px; overflow-y: auto; list-style-type:none; padding-left:0;"></ul>
      </div>
    </section>
  </main>
</div>

<script>
  // Config Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDg-uRqxD6-B4zQnn6buPUZEDTh7aHoBK8",
    authDomain: "belcoin-92ee8.firebaseapp.com",
    projectId: "belcoin-92ee8",
    storageBucket: "belcoin-92ee8.appspot.com",
    messagingSenderId: "604040948702",
    appId: "1:604040948702:web:ebxxxxxx"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Login fixo master
  const MASTER_EMAIL = "cjogos3339@gmail.com";
  const MASTER_PASSWORD = "rbarba9798";

  // Seletores
  const loginScreen = document.getElementById('login-screen');
  const panel = document.getElementById('panel');
  const errorMessage = document.getElementById('error-message');

  // Login function
  function login() {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    errorMessage.textContent = "";

    if (email !== MASTER_EMAIL) {
      errorMessage.textContent = "Usuário não autorizado.";
      return;
    }
    if (password !== MASTER_PASSWORD) {
      errorMessage.textContent = "Senha incorreta.";
      return;
    }
    // Login firebase anônimo só pra manter sessão ativa
    auth.signInAnonymously()
      .then(() => {
        loginScreen.style.display = 'none';
        panel.style.display = 'flex';
        showSection('dashboard');
        carregarDashboard();
        carregarUsuarios();
        carregarInvestimentos();
        carregarSaques();
        carregarCupons();
        carregarCargos();
        iniciarLogs();
      })
      .catch(e => {
        errorMessage.textContent = "Erro ao autenticar: " + e.message;
      });
  }

  // Logout
  function logout() {
    auth.signOut().then(() => {
      panel.style.display = 'none';
      loginScreen.style.display = 'flex';
      document.getElementById('email').value = '';
      document.getElementById('password').value = '';
    });
  }

  // Navegação de seções
  function showSection(section) {
    document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
    document.getElementById(section).style.display = 'block';
    document.getElementById('header-title').textContent = section.charAt(0).toUpperCase() + section.slice(1);

    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
    document.getElementById('link-' + section).classList.add('active');
  }

  // Dashboard
  function carregarDashboard() {
    db.collection('usuarios').get().then(snap => {
      document.getElementById('totalUsuarios').textContent = snap.size;
    });
    db.collection('investimentos').get().then(snap => {
      document.getElementById('totalInvestimentos').textContent = snap.size;
    });
    db.collection('saques').get().then(snap => {
      document.getElementById('totalSaques').textContent = snap.size;
    });
  }

  // Usuários
  function carregarUsuarios() {
    const tbody = document.getElementById('usuarios-lista');
    tbody.innerHTML = '';
    db.collection('usuarios').get().then(snap => {
      snap.forEach(doc => {
        const u = doc.data();
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${u.nome || ''}</td>
          <td>${u.email || ''}</td>
          <td>${u.cpf || ''}</td>
          <td>${u.telefone || ''}</td>
          <td>R$ ${u.saldo ? u.saldo.toFixed(2) : '0.00'}</td>
          <td>
            <button onclick="editarSaldo('${doc.id}')">Editar Saldo</button>
            <button onclick="removerUsuario('${doc.id}')">Remover</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  // Editar saldo do usuário
  function editarSaldo(userId) {
    const novoSaldo = prompt("Digite o novo saldo (R$):");
    if (novoSaldo === null) return;
    const saldoNum = parseFloat(novoSaldo.replace(',', '.'));
    if (isNaN(saldoNum)) {
      alert('Valor inválido!');
      return;
    }
    db.collection('usuarios').doc(userId).update({ saldo: saldoNum })
      .then(() => {
        alert('Saldo atualizado!');
        carregarUsuarios();
      })
      .catch(e => alert('Erro: ' + e.message));
  }

  // Remover usuário
  function removerUsuario(userId) {
    if (!confirm('Tem certeza que deseja remover esse usuário?')) return;
    db.collection('usuarios').doc(userId).delete()
      .then(() => {
        alert('Usuário removido!');
        carregarUsuarios();
      })
      .catch(e => alert('Erro: ' + e.message));
  }

  // Investimentos
  function carregarInvestimentos() {
    const tbody = document.getElementById('investimentos-lista');
    tbody.innerHTML = '';
    db.collection('investimentos').get().then(snap => {
      snap.forEach(doc => {
        const i = doc.data();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i.usuarioNome || ''}</td>
          <td>R$ ${i.valor ? i.valor.toFixed(2) : '0.00'}</td>
          <td>${i.data || ''}</td>
          <td>${i.status || ''}</td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  // Saques
  function carregarSaques() {
    const tbody = document.getElementById('saques-lista');
    tbody.innerHTML = '';
    db.collection('saques').get().then(snap => {
      snap.forEach(doc => {
        const s = doc.data();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.usuarioNome || ''}</td>
          <td>R$ ${s.valor ? s.valor.toFixed(2) : '0.00'}</td>
          <td>${s.data || ''}</td>
          <td>${s.status || ''}</td>
          <td>
            ${s.status === 'pendente' ? <button onclick="aprovarSaque('${doc.id}')">Aprovar</button> : '-'}
          </td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  function aprovarSaque(saqueId) {
    if (!confirm('Aprovar este saque?')) return;
    db.collection('saques').doc(saqueId).update({ status: 'aprovado' })
      .then(() => {
        alert('Saque aprovado!');
        carregarSaques();
      })
      .catch(e => alert('Erro: ' + e.message));
  }

  // Cupons
  function carregarCupons() {
    const tbody = document.getElementById('cupons-lista');
    tbody.innerHTML = '';
    db.collection('cupons').get().then(snap => {
      snap.forEach(doc => {
        const c = doc.data();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${c.codigo || ''}</td>
          <td>${c.desconto || 0}%</td>
          <td><button onclick="removerCupom('${doc.id}')">Excluir</button></td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  function criarCupom(e) {
    e.preventDefault();
    const codigo = document.getElementById('codigo-cupom').value.trim();
    const desconto = parseInt(document.getElementById('desconto-cupom').value);
    if (!codigo || isNaN(desconto) || desconto < 1 || desconto > 100) {
      alert('Preencha os campos corretamente!');
      return;
    }
    db.collection('cupons').add({ codigo, desconto })
      .then(() => {
        alert
