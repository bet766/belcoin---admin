<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Administrativo - Belcoin</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #333; color: white; }
    button { padding: 6px 12px; margin: 4px; }
    #logoutBtn { float: right; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Painel Administrativo Belcoin</h2>

    <div id="loginDiv">
      <p>Email:</p>
      <input type="email" id="emailInput" value="cjogos3339@gmail.com"><br>
      <p>Senha:</p>
      <input type="password" id="passwordInput" value="RBARBA7.0"><br><br>
      <button onclick="login()">Entrar</button>
    </div>

    <div id="painelDiv" class="hidden">
      <p>Bem-vindo, administrador!</p>
      <button id="logoutBtn" onclick="logout()">Sair</button>

      <h3>Lista de Usuários</h3>
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Email</th>
            <th>CPF</th>
            <th>Telefone</th>
            <th>Saldo</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody id="userList"></tbody>
      </table>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDg-uRqxD6-B4zQnn6buPUZEDTh7aHoBK8",
      authDomain: "belcoin-92ee8.firebaseapp.com",
      projectId: "belcoin-92ee8",
      storageBucket: "belcoin-92ee8.appspot.com",
      messagingSenderId: "604040948702",
      appId: "1:604040948702:web:ebfa60dc7a48b131315d8b"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginDiv = document.getElementById("loginDiv");
    const painelDiv = document.getElementById("painelDiv");
    const userList = document.getElementById("userList");

    function login() {
      const email = document.getElementById("emailInput").value;
      const password = document.getElementById("passwordInput").value;

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          loginDiv.classList.add("hidden");
          painelDiv.classList.remove("hidden");
          carregarUsuarios();
        })
        .catch(error => {
          alert("Erro no login: " + error.message);
        });
    }

    function logout() {
      auth.signOut().then(() => {
        painelDiv.classList.add("hidden");
        loginDiv.classList.remove("hidden");
      });
    }

    function carregarUsuarios() {
      userList.innerHTML = "";

      db.collection("usuarios").get().then(querySnapshot => {
        querySnapshot.forEach(doc => {
          const data = doc.data();
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${data.nome || ""}</td>
            <td>${data.email || ""}</td>
            <td>${data.cpf || ""}</td>
            <td>${data.telefone || ""}</td>
            <td>R$ ${data.saldo != null ? data.saldo.toFixed(2) : "0.00"}</td>
            <td>
              <button onclick="alterarSaldo('${doc.id}', true)">+ R$10</button>
              <button onclick="alterarSaldo('${doc.id}', false)">- R$10</button>
            </td>
          `;
          userList.appendChild(tr);
        });
      });
    }

    function alterarSaldo(userId, aumentar) {
      const userRef = db.collection("usuarios").doc(userId);
      db.runTransaction(async (t) => {
        const doc = await t.get(userRef);
        if (!doc.exists) return;

        const saldoAtual = doc.data().saldo || 0;
        const novoSaldo = aumentar ? saldoAtual + 10 : saldoAtual - 10;

        t.update(userRef, { saldo: novoSaldo });
      }).then(() => {
        carregarUsuarios();
      });
    }

    auth.onAuthStateChanged(user => {
      if (user && user.email === "cjogos3339@gmail.com") {
        loginDiv.classList.add("hidden");
        painelDiv.classList.remove("hidden");
        carregarUsuarios();
      } else {
        auth.signOut();
      }
    });
  </script>
</body>
</html>